<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Click-to-Call Dialer</title>
  <script src="https://cdn.jsdelivr.net/npm/monday-sdk-js/dist/main.js"></script>
</head>

<body style="font-family: Arial, sans-serif; background-color: #f5f7fa; margin: 0; padding: 40px;">
  <div
    style="max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 8px 16px rgba(0,0,0,0.1);">

    <h1 style="color: #2d3748; font-size: 26px; margin-bottom: 20px;">ðŸ“ž Click-to-Call Dialer</h1>

    <div id="output"
      style="background-color: #f1f5f9; padding: 20px; border-radius: 8px; margin-bottom: 20px; color: #1a202c;">
      <p>Loading Monday context...</p>
    </div>

    <button id="openModalBtn"
      style="background-color: #0073ea; color: white; border: none; border-radius: 6px; padding: 12px 18px; font-size: 16px; cursor: pointer; transition: background-color 0.3s;">
      âž• Open App Feature Modal
    </button>
    <script>
      const monday = window.mondaySdk();
      monday.get("context").then((res) => {
        console.log("Context:", res.data);
      });

      // Request context from Monday.com
      monday.get("context").then((res) => {
        const context = res.data;
        const boardId = context.boardId;
        const itemId = context.itemId;
        const userId = context.user.id;
        const workspaceId = context.workspaceId;

        // Display context
        document.getElementById("output").innerHTML = `
        <p>ðŸ§¾ <strong>Board ID:</strong> ${boardId}</p>
        <p>ðŸ“Œ <strong>Item ID:</strong> ${itemId}</p>
        <p>ðŸ‘¤ <strong>User ID:</strong> ${userId}</p>
        <p>ðŸ’¼ <strong>Workspace ID:</strong> ${workspaceId}</p>
        <p>ðŸ“ž <strong>Phone:</strong> Fetching...</p>
      `;

        // Fetch phone number (adjust "phone" if your column ID is different)
        const query = `
        query {
          items(ids: [${itemId}]) {
            column_values(ids: ["phone"]) {
              id
              title
              text
            }
          }
        }
      `;

        monday.api(query).then((res) => {
          const phone = res?.data?.items?.[0]?.column_values?.[0]?.text || "Not found";
          document.querySelector("#output").innerHTML += `<p>ðŸ“± <strong>Phone Number:</strong> ${phone}</p>`;
          console.log("ðŸ“ž Phone:", phone);
        });
      });

      // Open modal
      document.getElementById("openModalBtn").addEventListener("click", () => {
        monday.execute("openAppFeatureModal", {
          urlPath: "/modal.html",
          height: 500,
          width: 800
        });
      });
    </script>
</body>

</html>